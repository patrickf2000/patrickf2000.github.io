<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Patrick Flynn's Website</title>
    <link rel="shortcut icon" type="image/png" href="/favicon.png">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <link rel="stylesheet" href="/theme/css/screen.css" type="text/css" />
    <link rel="stylesheet" href="/theme/css/pygments.css" type="text/css" />
    <link rel="stylesheet" href="/theme/css/print.css" type="text/css" media="print" />
    <meta name="generator" content="Pelican" />
    <meta name="description" content="" />
    <meta name="author" content="Patrick Flynn" />
</head>
<body>
    <header>
        <nav>
            <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/pages/contact-me.html">Contact Me</a></li>
                <li><a href="https://github.com/patrickf2000">GitHub</a></li>
                <li class="selected"><a href="/blog_index.html">Blog</a></li>
                <li><a href="/categories">Categories</a></li>
            </ul>
        </nav>
        <div class="header_box">
            <h1><a href="/">Patrick Flynn's Website</a></h1>
        </div>
    </header>
    <div id="wrapper">
        <div id="content">            <h4 class="date">Dec 13, 2020</h4>

            <article class="post">
                <h2 class="title">
                    <a href="/memory-and-counting-in-hardware.html" rel="bookmark" title="Permanent Link to &quot;Memory and Counting in Hardware&quot;">Memory and Counting in Hardware</a>
                </h2>

                
                

                <p>Electronics have been a secondary hobby of mine for a little while now... though I admit, I'm not too great at it. Actually, its more like an on-and-off thing. I'm trying to make it more of an on thing because its an interesting thing to do. I've written a few posts here on VHDL, which is a start.</p>
<p>Depending on what you want to do, having some sort of memory is an ideal start. I don't have any memory elements other than shift registers, but they can be used like regular set-and-release memory just as easily. And the other nice thing about them is that you can chain them together, which means you can basically make your memory as big or small as you want. For a starter project, I made a 16-bit binary counter. Okay, its really not <em>that</em> impressive; basically, the microcontroller does the counting and math, and the shift registers and a bunch of LED's are used to display the current number.</p>
<p>Here's an image of it running:</p>
<p><img alt="Photo" src="/images/arduino_counter.jpg"></p>
<p>Know what the number is? 663. 2^9 + 2^7 + 2^4 + 2^2 + 2^1 + 2^0 = 663. The counter is big-endian.</p>
<p>And for the curious, that's a cell phone charger powering it. Yes, I had to program it at my computer, but the computer was in a room with horrible lighting.</p>
<p>Okay, so as far as parts list goes, here's what I used:   </p>
<ul>
<li>Arduino- any model is fine, but I only have a Micro   </li>
<li>(x2) SN74HC595N (8-bit shift register)   </li>
<li>(x16) LED lights   </li>
<li>(x16) 220 ohm resistors (this doesn't have to be exact, but it shouldn't be much if any lower)   </li>
<li>Wires   </li>
</ul>
<p>As you can see, I have two types of wire- the regular jumper wires and some thicker doorbell wire. The doorbell wire is great. Its not too hard to work with, and you can buy this huge strand from Lowe's for $10 that will last forever.</p>
<h3>Building the Circuit</h3>
<p>Here's a diagram of the shift register pinout:</p>
<p><img alt="Photo" src="/images/74HC595_pinout.png"></p>
<p>Unfortunately, I don't have a drawing or anything of my circuit, so I will describe it as best as I can.</p>
<p>For the first shift register:</p>
<ul>
<li>Connect VCC and GND to voltage and ground, respectively   </li>
<li>Connect OE to to ground   </li>
<li>Connect SRCLR to voltage   </li>
<li>Connect SER to the arduino (on mine, its pin 2). This is the data pin.   </li>
<li>Connect RCLK to the arduino (on mine, pin 3). This is the latch pin.   </li>
<li>Connect SRCLK to the arduino (on mine, pin 4). This is the clock pin.   </li>
</ul>
<p>The second shift register is similar. But because we want to control both at once, there are a few important differences.</p>
<ul>
<li>Connect SER to the Qh' pin on the first register   </li>
<li>Connect the RCLK and SRCLK to the RCLK and SRCLK of the first register   </li>
</ul>
<p>On both registers, pins Qa - Qh will connect to LEDs. The overall connect for the LEDs will be <code>shift register pin -&gt; resistor -&gt; LED -&gt; ground</code>.</p>
<h3>Programming</h3>
<p>I'm going to assume you know the basics of Arduino programming. If you have the program installed and know you to compile and upload the example program for making the onboard LED blink, you're good to continue.</p>
<p>I'll post the entire code on another page, but this is the general idea for programming a shift register. A single shift register works with 1 byte, or 8 bits, which corresponds to the <code>byte</code> type in the Arduino language.</p>
<ol>
<li>Set the latch pin to 0.   </li>
<li>Enter a loop and write out the byte of data.   </li>
<li>Set the latch pin to 1.   </li>
</ol>
<p>And the algorithm for the loop is (each loop iteration):</p>
<ol>
<li>Set the clock pin to low.   </li>
<li>Set the data pin to the current bit. The current bit is the <code>data &amp; (1 &lt;&lt; i)</code> where <code>data</code> is your byte value, and <code>i</code> is your loop index.   </li>
<li>Set the clock pin to high.   </li>
<li>Set the data pin to low (so we can have a stable signal).   </li>
</ol>
<p>The principle is exactly the same whether you have one shift register or 10. In our case we have two, which means we can display 16 bits of data, which corresponds to a <code>short</code> in the Arduino language (and all other languages that have it...). The easiest way to do this is first put the algorithm in a separate function, which we will call <code>writeOut(byte shiftData)</code>. Then, after you set the latch pin to 0, make two calls to <code>writeOut</code>, the first call with one half of the data, the second call with the other half. Then raise the latch pin. Both shift registers will be populated. If you have 10 shift registers, you would make 10 function calls in between lowering and raising the latch.</p>
<p>If you're wondering about order, think of it as a top-down thing. The first function call will the be the last shift register, and the last function call will be the first shift register. Get it? Shift register...</p>
<p>Okay. Here's the code. I put it on a separate page since its long. You can find it <a href="pages/shift-register-program.html">here</a>.</p>
                <div class="clear"></div>

                <div class="info">
                    <a href="/memory-and-counting-in-hardware.html">posted at 12:15</a>
                    &nbsp;&middot;&nbsp;<a href="/category/electronics.html" rel="tag">Electronics</a>
                </div>
            </article>            <h4 class="date">Dec 09, 2020</h4>

            <article class="post">
                <h2 class="title">
                    <a href="/vintage-os.html" rel="bookmark" title="Permanent Link to &quot;Vintage OS&quot;">Vintage OS</a>
                </h2>

                
                

                <p>So I was cleaning house earlier... Or rather, cleaning the computer. You know, when there gets to be a million things on your desktop? Anyway.</p>
<p>I have a small collection of vintage operating systems, some of which I've been able to get running in virtual machines. When I say vintage, I don't necessarily mean the ones everyone has heard about; there's a few obscure you may never have heard of. But anyway, I forgot I had screenshots of them because they are with the OSes and not the rest of my pictures. I only have three OSes photographed at the moment, but they are worth seeing.</p>
<h2>IBM OS/2</h2>
<p>The only truly vintage one here. The history behind this operating system is interesting. It runs without any issues in Virtualbox, but as I remember it was a little tricky to get running. I lost the article, but if I ever decide to run it again, I'll be sure to post.</p>
<p><img alt="Photo" src="/images/os2.png"></p>
<h2>Sky OS</h2>
<p>Sky OS was a fairly complete operating system written mainly by Robert Szeleney from 1997 until 2009. It was a Unix-like OS with a graphical desktop, and even got to the point of being able to run real applications such as the GNU Toolchain and Firefox. The OS was meant to be a commerical product, but it never aquired a sufficient developer/user base, and eventually, Szeleney couldn't keep up with development. You can still find disk images and a key and boot it up in Virtualbox. Its a rather nice OS, its a shame it never went further.</p>
<p>The desktop:</p>
<p><img alt="Photo" src="/images/skyos1.png"></p>
<p>Some applications running:</p>
<p><img alt="Photo" src="/images/skyos2.png"></p>
<h2>Syllable OS</h2>
<p>Another free OS from the early 2000s. Unlike Sky OS, Syllable was actually open source. It eventually stagnated and development ended in 2012. There wasn't a huge team behind this one either, and it got really far in terms of capabilities. Its a shame neither this nor Sky OS ever became viable alternatives to Windows because they really had potential.</p>
<p>The desktop:</p>
<p><img alt="Photo" src="/images/syllable1.png"></p>
<p>The file explorer:</p>
<p><img alt="Photo" src="/images/syllable2.png"></p>
                <div class="clear"></div>

                <div class="info">
                    <a href="/vintage-os.html">posted at 12:30</a>
                    &nbsp;&middot;&nbsp;<a href="/category/random.html" rel="tag">Random</a>
                </div>
            </article>            <h4 class="date">Dec 05, 2020</h4>

            <article class="post">
                <h2 class="title">
                    <a href="/arm64-on-qemu.html" rel="bookmark" title="Permanent Link to &quot;Arm64 on Qemu&quot;">Arm64 on Qemu</a>
                </h2>

                
                

                <p>I think I wrote a little bit about this at one point, but one of my new low-level interests is Arm. Partly because of my work in the HPC field, I've found the Arm supercomputer in Japan to be really intersting. I find it really interesting how what was the architecture of smartphones is now making its way into other fields. Its even coming into the PC market- look at the new Apple computers. But from an even more personal perspective, I've found RISC architectures really interesting. I grew up (so to speak) on x86- and therefore, CISC architectures. Writing a compiler to generate CISC code is really easy; adapting that same code to RISC is an interesting challenge.</p>
<p>Out of work and personal needs, I've been trying to get some emulators working for non-x86 architectures. I do have a Raspberry Pi 4, but while it is usable, its a little slow, and doesn't have any SVE support (SVE is Arm's SIMD architecture). So far, I have MIPS32, RiscV64, Power 10, and AArch64 emulators up and running. The MIPS32 and AArch64 work pretty well; the RISC-V is getting there, and the POWER 10 really sucks (I'm working on it though). Today, I'm going to cover how to set up Ubuntu 20.04 on QEMU.</p>
<h3>Words of Warning</h3>
<p>Virtualization is always slower than bare metal. Before you start giving me examples on how well Virtualbox works on your computer, yes you're probably right. But the reason why you can run an entire guest system on Virtualbox with really good speed is because the VM and the host system are x86 based. So the VM doesn't have to do as much translation. For different architectures, every single instruction has to be translated to an x86 instruction. On its own, its still really fast, but when you have an entire operating system on top of it, you will start to notice the difference.</p>
<p>I'm not saying this to scare you off. If you have a powerful computer, you can allocate resources to reduce this overhead quite a bit, but you will notice. Its good enough for real work, but I wouldn't plan on running any huge builds too often, or do things too resource-intensive.</p>
<p>I'll post updates over time.</p>
<h3>Words of Credit</h3>
<p>I like to think I'm a genius, but let's be realistic: I'm not. Therefore, let us give credit where it is due. I initially got things going by following this article: <a href="https://futurewei-cloud.github.io/ARM-Datacenter/qemu/how-to-launch-aarch64-vm/">https://futurewei-cloud.github.io/ARM-Datacenter/qemu/how-to-launch-aarch64-vm/</a>. A lot of stuff is copied from that article, so I wish to emphasize that most credit should be given to that author, not to me.</p>
<p>The reason why I wrote my own is A) it would be easily accessible for me, and B) I did have to make some changes to warrant a rewrite. The article is a little old, if you follow it, you will end up with Ubuntu 18.04. If you follow mine, you end up with Ubuntu 20.04. You will need this if you want SVE.</p>
<p>And yes, I do focus on SVE.</p>
<h3>Getting Started</h3>
<p>First, you need to install these packages (note: I'm on Linux Mint. If you're not on Linux Mint/Ubuntu/Debian, you may have to change the package names):</p>
<div class="highlight"><pre><span></span><span class="err">sudo apt-get install qemu-system-arm qemu-efi-aarch64 qemu-utils</span>
</pre></div>


<p>Next, create the boot images and the hard drive:</p>
<div class="highlight"><pre><span></span><span class="n">dd</span> <span class="k">if</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">zero</span> <span class="k">of</span><span class="o">=</span><span class="n">flash1</span><span class="p">.</span><span class="n">img</span> <span class="n">bs</span><span class="o">=</span><span class="mi">1</span><span class="n">M</span> <span class="k">count</span><span class="o">=</span><span class="mi">64</span>
<span class="n">dd</span> <span class="k">if</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">zero</span> <span class="k">of</span><span class="o">=</span><span class="n">flash0</span><span class="p">.</span><span class="n">img</span> <span class="n">bs</span><span class="o">=</span><span class="mi">1</span><span class="n">M</span> <span class="k">count</span><span class="o">=</span><span class="mi">64</span>
<span class="n">dd</span> <span class="k">if</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="k">share</span><span class="o">/</span><span class="n">qemu</span><span class="o">-</span><span class="n">efi</span><span class="o">-</span><span class="n">aarch64</span><span class="o">/</span><span class="n">QEMU_EFI</span><span class="p">.</span><span class="n">fd</span> <span class="k">of</span><span class="o">=</span><span class="n">flash0</span><span class="p">.</span><span class="n">img</span> <span class="n">conv</span><span class="o">=</span><span class="n">notrunc</span>

<span class="n">qemu</span><span class="o">-</span><span class="n">img</span> <span class="k">create</span> <span class="n">ubuntu</span><span class="o">-</span><span class="n">image</span><span class="p">.</span><span class="n">img</span> <span class="mi">20</span><span class="k">G</span>
</pre></div>


<p>To download Ubuntu 20.04: </p>
<p><code>wget http://ports.ubuntu.com/ubuntu-ports/dists/focal/main/installer-arm64/current/legacy-images/netboot/mini.iso</code></p>
<p>Note that the site in question is an FTP site. If you want a different image, go for it.</p>
<h3>Install Ubuntu</h3>
<p>Use this command to start the installation:</p>
<div class="highlight"><pre><span></span><span class="err">qemu-system-aarch64 \</span>
<span class="err">    -nographic \</span>
<span class="err">    -machine virt,gic-version=max \</span>
<span class="err">    -m 4G \</span>
<span class="err">    -cpu max \</span>
<span class="err">    -smp 4 \</span>
<span class="err">    -netdev user,id=vnet,hostfwd=:127.0.0.1:0-:22 -device virtio-net-pci,netdev=vnet \</span>
<span class="err">    -drive file=ubuntu-image.img,if=none,id=drive0,cache=writeback -device virtio-blk,drive=drive0,bootindex=0 \</span>
<span class="err">    -drive file=mini.iso,if=none,id=drive1,cache=writeback -device virtio-blk,drive=drive1,bootindex=1 \</span>
<span class="err">    -drive file=flash0.img,format=raw,if=pflash -drive file=flash1.img,format=raw,if=pflash </span>
</pre></div>


<p>Few notes here. First, the <code>-m 4G</code> represents how much memory to allocate to the machine. The original article said to use 512M. That took <em>FOREVER</em> on my computer, so I would highly recommend to scale this up (once I scalled it, it only took like 15 minutes). The <code>-smp 4</code> represents the number of CPU cores to allocate to the machine.</p>
<p>Just follow the prompts and instructions to install the system. It's really easy, so I'm not going to walk you through. When you get to the end where it asks about additional software, I would only recommend doing the SSH server. Don't install a desktop system unless you're feeling adventerous. It will be slow. And quite frankly, I have no idea how you would run it... Maybe VNC?</p>
<h3>Boot Ubuntu</h3>
<p>One you finished installing, you can use this command to launch the VM. You should put this in a script to make it easier to launch each time.</p>
<div class="highlight"><pre><span></span><span class="err">qemu-system-aarch64 \</span>
<span class="err">    -nographic \</span>
<span class="err">    -machine virt,gic-version=max \</span>
<span class="err">    -m 8G \</span>
<span class="err">    -cpu max,pmu=off,sve=on,sve256=on \</span>
<span class="err">    -smp 6 \</span>
<span class="err">    -netdev user,id=vnet,hostfwd=tcp::5556-:22 \</span>
<span class="err">    -device virtio-net-pci,netdev=vnet \</span>
<span class="err">    -drive file=ubuntu-image.img,if=none,id=drive0,cache=writeback -device virtio-blk,drive=drive0,bootindex=0 \</span>
<span class="err">    -drive file=flash0.img,format=raw,if=pflash -drive file=flash1.img,format=raw,if=pflash </span>
</pre></div>


<p>Again, I made a few changes from the original article. I scaled the memory and SMP up to my specs, so <em>make sure</em> to check that before you run it. If you scale up more than your computer can handle, it may freeze.</p>
<p>Notice the "sve" arguments in the "-cpu" line. This is where you can control the SVE vector lane size. SVE vectors start at 128-bits and increment from there by 128 up to 2048-bits. Also notice the line that begins with "-netdev". This allows you to SSH into the VM. For some reason, even if you're terminal is maximized, QEMU doesn't use the whole thing. SSH makes it more usable. The "5556-:22" sets the SSH port. So, to SSH in, you can use the following command:</p>
<div class="highlight"><pre><span></span><span class="err">ssh user@localhost -p 5556</span>
</pre></div>


<p>Replace "user" with whatever user you created during installation.</p>
<h3>Conclusion</h3>
<p>If all goes well, you shouldn't have any issues getting this up and working. So far this seems to run pretty well (even if it makes my computer run up a lot in the process :-). As I get over machines to work, I'll post updates here, and if I do anything interesting I'll try to also post.</p>
                <div class="clear"></div>

                <div class="info">
                    <a href="/arm64-on-qemu.html">posted at 12:45</a>
                    &nbsp;&middot;&nbsp;<a href="/category/virtualization.html" rel="tag">Virtualization</a>
                </div>
            </article>            <h4 class="date">Dec 04, 2020</h4>

            <article class="post">
                <h2 class="title">
                    <a href="/android-and-planning.html" rel="bookmark" title="Permanent Link to &quot;Android and Planning&quot;">Android and Planning</a>
                </h2>

                
                

                <p>When I got my Android smartphone back in early 2018, one of the first things I did was look for a decent notepad. You may not think much about it, but this is a really nice feature to have- you want it at unexpected moments. For some reason Android doesn't provide one. That's something I really have to give Apple devices.</p>
<p>This may upset some people, but honestly, the app store is kind of a trash pit. Especially the Google Play store. All I needed was a simple notepad, and really, every one of them seemed to be either this huge thing with a trillion features I'd never use, tons or ads, or looking like it was from Android 2. This is with a lot of things. I always find it hard to find a decent app for what I need to do, and even if I find something decent (and there are some), a lot of things either have tons of adds or require an account. And I also don't always trust that an app will stick around because the good ones tend to more obscure.</p>
<p>For my non-technical readers, F-Droid is a really good option to find simple, easy-to-use, bloat-free, ad-free applications. While I do use several apps from there, if all else fails, I take an unorthodox approach: I write my own apps.</p>
<p>Okay, I've actually only written three, including the most recent. My first was Notepad (original, huh?). I'll admit it, it wasn't fully annoyance with the app store that I wrote this, I did want to see what Android development was like. Now, almost three years later, I'm still using Notepad. Its simple, and does the job perfectly. Here's a screenshot:</p>
<p><img alt="Photo" src="/images/notepad.jpg"></p>
<p>This past week, I started a new project (I actually only spent a day on it... I also only spent like a day on the Notepad come to think of it). Even though I'm part of the technology generation and work in computer science, I still use paper for a lot of things, including daily planning. My planning system is basically a calendar/day planner where I write things like due dates and general tasks, and an old composition book where I plan out the day itself. I use a method called block planning. Basically, the idea is that you break down your day into blocks, where you do something like work, maybe school, maybe lunch hour, free time, whatever. Its a lesser known but still popular planning system, and its really efficient (fun fact: Benjamin Franklin used it).</p>
<p>For the curious, I only spend like 10-15 minutes each evening planning, and then use a little more time Saturday or Sunday (usually 30ish minutes) to write down all the tasks for the upcoming week. Here's the paper version:</p>
<p><img alt="Photo" src="/images/planners.jpg"></p>
<p>I'm trying to start migrating more things to digital because honestly I find using a notebook for the daily planning a little wasteful. Actually the notebook in question was actually recycled from something else... So maybe not completely a waste. But you know. For some reason, I could find absolutely nothing like what I had in mind after scouring the app store. I did find a few that met the requirements of simplicity and ad-free, but they weren't too suited to time block.</p>
<p>Solution. I wrote my own to run on my tablet:</p>
<p><img alt="Photo" src="/images/block_planner.jpg"></p>
<p>If you understand even basic programming, Android is pretty easy to pick up. You will need a fairly decent computer to run Android Studio, but other than that, you can get started with app development pretty quickly. Google has really good documentation and a simple web search will fix pretty much any problem you have or anything you want to do. So yeah... I kind of Googled my way through it. I'm a compiler guy.</p>
<p>The design is pretty straight forward. Choose your starting template, and Android Studio sets up the code and everything. The main layout is a two-column grid layout; each row corresponds to a particular hour of the day (I use 24-hour format). Then use the bottom below and you can create a block spanning as many hours as you need. The task is only recorded on the first hour of your block. Finally, I use the key-value storage for colors and text. When you're done for the day, just clear it out and plan the next.</p>
<p>I will admit its not the most elegant thing ever. The dialog for adding blocks isn't great, and there's no error handling for wrong input (but it doesn't completely crash). In the near future, I will have to add a second screen for writing down any notes/lists for the day (sometimes I just write "work" for a block, then at the bottom of the page, write the list of things I want to get done).</p>
<p>The app isn't on the app store and probably never will be. I did upload APK's to the downloads page, so if you're interested you can try it here. Feel free to email me about it if you want.</p>
                <div class="clear"></div>

                <div class="info">
                    <a href="/android-and-planning.html">posted at 19:38</a>
                    &nbsp;&middot;&nbsp;<a href="/category/programming.html" rel="tag">Programming</a>
                </div>
            </article>            <h4 class="date">Oct 19, 2020</h4>

            <article class="post">
                <h2 class="title">
                    <a href="/building-an-alu.html" rel="bookmark" title="Permanent Link to &quot;Building an ALU&quot;">Building an ALU</a>
                </h2>

                
                

                <p>VHDL has been a fun new toy for me :) . I find how computers work down on the hardware level really interesting- meaning the underlying logic by which they do operations. This is part of the reason I got into compilers. I love seeing how programming constructs translate into CPU instructions, and then how the CPU instructions are translated into logical operations (or rather, the logic behind these operations).</p>
<p>Integer math and bitwise operations are some of the most fundamental instructions to a computer. While modern CPU's can do tons of different operations, the most commonly used instructions are data moves, jumps, and the integer operations. The x86 instruction set is huge, but the majority of programs only use around 15-20 of them (if you don't count the different variants, its really like 10-15). Of these 10-15 instructions, probably about two thirds of them are in the arithmetic logic unit (ALU). Because I find binary math interesting, I decided to try making one in VHDL.</p>
<p>I'm not going to describe my actually code here, I'm just going to go into the theory behind it. If you want to see some code, take a look at my "simple-alu" project on Github.</p>
<p>An ALU is actually quite simple. The ALU I built works with 8-bit signed integers, and can do addition, subtraction, 2's complement, and/or/xor/not, increments, and decrements. Much of the ALU is built around the adder circuit. I wrote about my 8-bit adder in a fairly recent post; I reused the code here. Once you have that piece done, you can do the rest pretty easily.</p>
<p>An adder in the sense I talk about here is a sequence of full adders, which work on two bits and return a sum and a carry. A full adder takes the exclusive-or (xor) of inputs A and B, xor's that with a carry-in, which produces the sum. The carry-out is ((a xor b) and carry-in) or'ed with (a and b). To work with numbers larger than one bit, you simply use a bunch of these full adders, with the carry-out connected to the carry-in of the next adder in the sequence (in the case of the first adder, the carry-in is set to 0). You can use the same adder circuit for signed and unsigned numbers.</p>
<p>As I said, much of the ALU is built around the adder. Once you have the adder done, you can do addition, subtraction, 2's complement, increments, and decrements. The and/xor/xor/not gates are simply that operation applied to each bit of the input (the not gate only requires one input, as it just flips the bits of each input). I won't cover those here, as that should be pretty easy to understand. Let's move on to the other components.</p>
<p>In order to understand the other operations, you must understand how negative or signed numbers are represented in binary. A negative number is represented as the 2's complement of the absolute value (or the positive number). To find the 2's complement, you invert all the bits of the original number and add 1. So for 3, the binary in four bits is 0011. You probably know that in binary, each digit corresponds to a power of 2, starting with 2 ^ 0 on the far right. So for our binary number above, to convert to decimal, you add 2 ^ 0 + 2 ^ 1 = 3 (you ignore the first two digits because they are zero). To get -3, invert the bits- so 1100- and add 1- so 1101. How do we know this equals -3? Use the same conversion method as above; however, the number to the far left (the most significant bit) is negative two raised to whatever power. So -2 ^ 3 + 2 ^ 2 + 2 ^ 0, which equals -8 + 4 + 1, which equals -3. Kind of cool right? In case you're wondering, you know that the number is negative because the MSB equals 1.</p>
<p>Now that we understand 2's complement, we can finish the other operations. First, the 2's complement unit. This unit is super simple. You can use the 8-bit NOT unit to flip all the bits, and then add 1 to it using our adder. All done.</p>
<p>Now for the subtractor. Computers don't have the concept of subtraction in the way you might think of it. Consider 5 - 3. The answer is 2. Now, think of it as an addition operation with negative numbers. The problem becomes 5 + (-3). What's the answer? Still 2. This is how computers do subtraction. They negate the second number, and add it to the first. Let's do this in binary. 5 in binary is 0101. 3 is 0011. 3 negated (or -3) is 1101. Let's add it together: 0101 + 1101. The answer is 0010 with a carry of 1. However, because we are dealing with 4-bit numbers, we can drop the carry, leaving us only with 0010. What's that in decimal? 2 ^ 1 (for the second digit place) = 2, so our answer is correct.</p>
<p>So the subtractor unit simply uses the 2's complement unit to negate the second input, and then adds that result to the first input, which yields our result.</p>
<p>After that, we only have the increment and decrement units left. These only take one input, and internally use the adder and subtractor units hardwired with 1 to calculate the result. </p>
<p>The only two components left at the moment are the left and right shifters. I have a high-level understanding of how those work, but not enough to generate the VHDL code. I honestly think these are the most complex components in the circuit. I may write about them once I get them implemented.</p>
<p>You're probably wondering how the ALU decides which operation to perform. An ALU takes two integer inputs and an opcode input. The opcode decides the operation, and the opcode is decoded using a multiplexer. I'll probably reserve a more detailed discussion on multiplexers for later when I can draw a diagram, but for now here's a hopefully somewhat clear explanation of how it works in our case.</p>
<p>A multiplexer takes several inputs, and based on the value of one or more selector inputs, produces a single output (which is one of the inputs). Our ALU has a 4-bit selector input, meaning that we can choose from 16 inputs (in reality, I think I only use 12). The two numerical inputs of the ALU are connected to each of the ALU's operations. Depending on the opcode, the result of that operation is the one allowed to move through the bus to the output. Basically, all the operations are computed once the ALU is invoked, but depending on the opcode, only one of the results is allowed through the bus into the output.</p>
<p>That concludes our walk-though on a basic integer ALU. Other than the left and right shifts, I'm not sure if I'll do much more to this project. I am thinking about drawing out a schematic for it, maybe even building it. I'll write if I do.</p>
                <div class="clear"></div>

                <div class="info">
                    <a href="/building-an-alu.html">posted at 08:38</a>
                    &nbsp;&middot;&nbsp;<a href="/category/programming.html" rel="tag">Programming</a>
                    &nbsp;&middot;
                    &nbsp;<a href="/tag/programming.html" class="tags">Programming</a>
                    &nbsp;<a href="/tag/hardware.html" class="tags">Hardware</a>
                    &nbsp;<a href="/tag/vhdl.html" class="tags">VHDL</a>
                </div>
            </article>

                <div class="clear"></div>
                <div class="pages">

                    <a href="/page/2" class="next_page">Next&nbsp;&rarr;</a>
                    <span>Page 1 of 4</span>
                </div>

            <div class="clear"></div>
            <footer>
                <p>
                <a href="https://github.com/jody-frankowski/blue-penguin">Blue Penguin</a> Theme
                &middot;
                Powered by <a href="http://getpelican.com">Pelican</a>
            </footer>
        </div>
        <div class="clear"></div>
    </div>
    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-213498014-7");
    pageTracker._trackPageview();
    } catch(err) {}</script>
</body>
</html>